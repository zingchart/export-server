# overall CI pipeline name
name: Deploy to GAE

# only run on master and stage branches
on:
  push:
    branches:
    - master
    - stage

# Environment variables available to all jobs and steps in this workflow
env:
  PROJECT_ID: ${{secrets.GCLOUD_PROJECT_ID}}
  APPLICATION_CREDENTIALS: ${{secrets.GOOGLE_APPLICATION_CREDENTIALS}}
    
# jobs are the different pipelines
jobs:
  build:

    runs-on: ubuntu-latest
    name: Publish and Deploy
    
    # define all the steps in the "build" stage
    steps:
    # deploy to GAE step
    - uses: actions-hub/gcloud@master
      
    # Configure where to deploy export server
    - name: Deploy Stage
      if: $GITHUB_REF	== 'stage'
      run: |
        gcloud app deploy --version stage
    - name: Deploy Production
      if: $GITHUB_REF	== 'master'
      run: |
        gcloud app deploy
